# å‰åç«¯è”è°ƒå®ŒæˆæŒ‡å— ğŸ‰

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åˆ›å»ºç»Ÿä¸€ API é€‚é…å™¨ âœ“
- ğŸ“ åˆ›å»ºäº† `src/shared/services/unified-api.ts`
- ğŸ”€ æ”¯æŒæœ¬åœ° IndexedDB å’Œåç«¯ API è‡ªåŠ¨åˆ‡æ¢
- ğŸ”„ æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œå‰ç«¯é¡µé¢æ— éœ€ä¿®æ”¹

### 2. æ›´æ–°æ‰€æœ‰é¡µé¢ âœ“
å·²å°†ä»¥ä¸‹é¡µé¢æ›´æ–°ä¸ºä½¿ç”¨ç»Ÿä¸€ APIï¼š
- âœ“ Dashboardï¼ˆä»ªè¡¨ç›˜ï¼‰
- âœ“ Projectsï¼ˆé¡¹ç›®ç®¡ç†ï¼‰
- âœ“ ProjectDetailï¼ˆé¡¹ç›®è¯¦æƒ…ï¼‰
- âœ“ AuditTasksï¼ˆå®¡è®¡ä»»åŠ¡ï¼‰
- âœ“ TaskDetailï¼ˆä»»åŠ¡è¯¦æƒ…ï¼‰
- âœ“ AdminDashboardï¼ˆç³»ç»Ÿç®¡ç†ï¼‰
- âœ“ RecycleBinï¼ˆå›æ”¶ç«™ï¼‰
- âœ“ Loginï¼ˆç™»å½•ï¼‰
- âœ“ InstantAnalysisï¼ˆå³æ—¶åˆ†æï¼‰
- âœ“ CreateTaskDialogï¼ˆåˆ›å»ºä»»åŠ¡å¯¹è¯æ¡†ï¼‰

### 3. API åŠŸèƒ½å¯¹æ¥ âœ“
- âœ“ é¡¹ç›®ç®¡ç†ï¼ˆåˆ›å»ºã€åˆ—è¡¨ã€è¯¦æƒ…ã€æ›´æ–°ã€åˆ é™¤ï¼‰
- âœ“ ä»»åŠ¡ç®¡ç†ï¼ˆåˆ›å»ºã€åˆ—è¡¨ã€è¯¦æƒ…ã€çŠ¶æ€æ›´æ–°ï¼‰
- âœ“ é—®é¢˜ç®¡ç†ï¼ˆåˆ—è¡¨ã€è¯¦æƒ…ã€çŠ¶æ€æ›´æ–°ï¼‰
- âœ“ ç»Ÿè®¡æ•°æ®ï¼ˆDashboard æ•°æ®ï¼‰
- âœ“ æ•°æ®æ ¼å¼è½¬æ¢é€‚é…

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### æ–¹å¼ 1: ä½¿ç”¨åç«¯ APIï¼ˆæ¨èï¼‰

```bash
# 1. ç¡®è®¤åç«¯æ­£åœ¨è¿è¡Œ
curl http://localhost:8000/health

# 2. å¯åŠ¨å‰ç«¯ï¼ˆå·²é…ç½®ä½¿ç”¨åç«¯APIï¼‰
npm run dev

# 3. è®¿é—®åº”ç”¨
# å‰ç«¯: http://localhost:5173
# åç«¯APIæ–‡æ¡£: http://localhost:8000/api/v1/docs
```

### æ–¹å¼ 2: åˆ‡æ¢å›æœ¬åœ° IndexedDB

ç¼–è¾‘ `.env.local` æ–‡ä»¶ï¼š
```bash
# æ”¹ä¸º false ä½¿ç”¨æœ¬åœ° IndexedDB
VITE_USE_BACKEND_API=false
```

ç„¶åé‡å¯å‰ç«¯ï¼š
```bash
npm run dev
```

## ğŸ“ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ï¼ˆ`.env.local`ï¼‰

```bash
# ==================== API é…ç½® ====================
# æ˜¯å¦ä½¿ç”¨åç«¯ API
# true  = ä½¿ç”¨åç«¯APIï¼ˆéœ€è¦åç«¯è¿è¡Œåœ¨ 8000 ç«¯å£ï¼‰
# false = ä½¿ç”¨æœ¬åœ°IndexedDBï¼ˆçº¯æµè§ˆå™¨ç«¯ï¼‰
VITE_USE_BACKEND_API=true

# åç«¯APIåœ°å€
VITE_API_BASE_URL=http://localhost:8000/api/v1

# ==================== LLM é…ç½® ====================
VITE_LLM_PROVIDER=gemini
VITE_GEMINI_API_KEY=ä½ çš„APIå¯†é’¥

# ==================== æ•°æ®åº“é…ç½® ====================
# æœ¬åœ°æ•°æ®åº“æ¨¡å¼ (ä»…å½“ USE_BACKEND_API=false æ—¶ç”Ÿæ•ˆ)
VITE_USE_LOCAL_DB=true
```

## ğŸ”„ æ•°æ®æµè½¬è¯´æ˜

### åç«¯ API æ¨¡å¼
```
å‰ç«¯é¡µé¢ â†’ unified-api.ts â†’ BackendAPIAdapter â†’ backend API client â†’ åç«¯æœåŠ¡å™¨
```

### æœ¬åœ° IndexedDB æ¨¡å¼
```
å‰ç«¯é¡µé¢ â†’ unified-api.ts â†’ localDB â†’ IndexedDB
```

## ğŸ“Š API æ˜ å°„å…³ç³»

| åŠŸèƒ½ | å‰ç«¯æ¥å£ | åç«¯ç«¯ç‚¹ | çŠ¶æ€ |
|------|---------|---------|------|
| è·å–é¡¹ç›®åˆ—è¡¨ | `api.getProjects()` | `GET /api/v1/projects` | âœ… |
| åˆ›å»ºé¡¹ç›® | `api.createProject()` | `POST /api/v1/projects` | âœ… |
| è·å–é¡¹ç›®è¯¦æƒ… | `api.getProjectById(id)` | `GET /api/v1/projects/{id}` | âœ… |
| æ›´æ–°é¡¹ç›® | `api.updateProject(id, data)` | `PUT /api/v1/projects/{id}` | âœ… |
| åˆ é™¤é¡¹ç›® | `api.deleteProject(id)` | `DELETE /api/v1/projects/{id}` | âœ… |
| è·å–ä»»åŠ¡åˆ—è¡¨ | `api.getAuditTasks()` | `GET /api/v1/tasks` | âœ… |
| åˆ›å»ºä»»åŠ¡ | `api.createAuditTask()` | `POST /api/v1/tasks` | âœ… |
| è·å–ä»»åŠ¡è¯¦æƒ… | `api.getAuditTaskById(id)` | `GET /api/v1/tasks/{id}` | âœ… |
| è·å–é—®é¢˜åˆ—è¡¨ | `api.getAuditIssues(taskId)` | `GET /api/v1/issues?task_id={taskId}` | âœ… |
| æ›´æ–°é—®é¢˜ | `api.updateAuditIssue(id, data)` | `PUT /api/v1/issues/{id}` | âœ… |
| è·å–ç»Ÿè®¡æ•°æ® | `api.getProjectStats()` | `GET /api/v1/statistics/overview` | âœ… |

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. æµ‹è¯•é¡¹ç›®ç®¡ç†åŠŸèƒ½

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ

// 1. è·å–é¡¹ç›®åˆ—è¡¨
const projects = await api.getProjects();
console.log('é¡¹ç›®åˆ—è¡¨:', projects);

// 2. åˆ›å»ºé¡¹ç›®
const newProject = await api.createProject({
  name: 'æµ‹è¯•é¡¹ç›®',
  description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é¡¹ç›®',
  repository_url: 'https://github.com/test/repo',
  repository_type: 'github',
  default_branch: 'main',
  programming_languages: ['JavaScript', 'TypeScript']
});
console.log('åˆ›å»ºçš„é¡¹ç›®:', newProject);

// 3. è·å–é¡¹ç›®è¯¦æƒ…
const project = await api.getProjectById(newProject.id);
console.log('é¡¹ç›®è¯¦æƒ…:', project);
```

### 2. æµ‹è¯•ä»»åŠ¡ç®¡ç†åŠŸèƒ½

```javascript
// 1. åˆ›å»ºä»»åŠ¡
const newTask = await api.createAuditTask({
  project_id: 'é¡¹ç›®ID',
  task_type: 'full_scan',
  branch_name: 'main',
  created_by: 'test-user'
});
console.log('åˆ›å»ºçš„ä»»åŠ¡:', newTask);

// 2. è·å–ä»»åŠ¡åˆ—è¡¨
const tasks = await api.getAuditTasks();
console.log('ä»»åŠ¡åˆ—è¡¨:', tasks);

// 3. è·å–ä»»åŠ¡è¯¦æƒ…
const task = await api.getAuditTaskById(newTask.id);
console.log('ä»»åŠ¡è¯¦æƒ…:', task);
```

### 3. æµ‹è¯•ç»Ÿè®¡æ•°æ®

```javascript
const stats = await api.getProjectStats();
console.log('ç»Ÿè®¡æ•°æ®:', stats);
```

## âš™ï¸ æ•°æ®æ ¼å¼è½¬æ¢

åç«¯APIå“åº”æ ¼å¼ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå‰ç«¯æ‰€éœ€æ ¼å¼ï¼š

### é¡¹ç›®æ•°æ®è½¬æ¢ç¤ºä¾‹

**åç«¯å“åº”:**
```json
{
  "id": 1,
  "name": "Test Project",
  "programming_languages": ["javascript", "typescript"],
  "created_at": "2025-11-02T12:00:00Z"
}
```

**è½¬æ¢åï¼ˆå‰ç«¯æ ¼å¼ï¼‰:**
```json
{
  "id": "1",
  "name": "Test Project",
  "programming_languages": "[\"javascript\",\"typescript\"]",
  "created_at": "2025-11-02T12:00:00Z",
  "is_active": true
}
```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: å‰ç«¯æ— æ³•è¿æ¥åç«¯

**ç—‡çŠ¶**: æ§åˆ¶å°æ˜¾ç¤ºç½‘ç»œé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤åç«¯æ­£åœ¨è¿è¡Œ: `curl http://localhost:8000/health`
2. æ£€æŸ¥ `.env.local` ä¸­çš„ `VITE_USE_BACKEND_API=true`
3. é‡å¯å‰ç«¯: `npm run dev`
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

### é—®é¢˜ 2: API è¿”å›æ•°æ®æ ¼å¼é”™è¯¯

**ç—‡çŠ¶**: é¡µé¢æ˜¾ç¤ºä¸æ­£å¸¸æˆ–æŠ¥é”™

**è§£å†³æ–¹æ¡ˆ**:
1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯
2. æ£€æŸ¥ `unified-api.ts` ä¸­çš„æ•°æ®è½¬æ¢é€»è¾‘
3. å¯¹æ¯”åç«¯ API æ–‡æ¡£: http://localhost:8000/api/v1/docs

### é—®é¢˜ 3: åˆ‡æ¢æ¨¡å¼åæ•°æ®ä¸¢å¤±

**è¯´æ˜**: è¿™æ˜¯æ­£å¸¸ç°è±¡
- æœ¬åœ°æ¨¡å¼æ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨ IndexedDB
- åç«¯æ¨¡å¼æ•°æ®å­˜å‚¨åœ¨åç«¯æ•°æ®åº“
- ä¸¤ç§æ¨¡å¼çš„æ•°æ®æ˜¯éš”ç¦»çš„

## ğŸ“š ä»£ç ç»“æ„

```
src/
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ unified-api.ts       # ç»Ÿä¸€APIå±‚ï¼ˆæ–°å¢ï¼‰âœ¨
â”‚   â”‚   â””â”€â”€ api/
â”‚   â”‚       â”œâ”€â”€ client.ts        # åç«¯APIå®¢æˆ·ç«¯
â”‚   â”‚       â””â”€â”€ index.ts         # åç«¯APIæ–¹æ³•
â”‚   â””â”€â”€ config/
â”‚       â”œâ”€â”€ database.ts          # åŸæœ¬åœ°æ•°æ®åº“API
â”‚       â””â”€â”€ localDatabase.ts     # IndexedDBå®ç°
â”œâ”€â”€ pages/                       # æ‰€æœ‰é¡µé¢å·²æ›´æ–° âœ…
â””â”€â”€ components/                  # ç›¸å…³ç»„ä»¶å·²æ›´æ–° âœ…
```

## ğŸ¯ ä¸‹ä¸€æ­¥å¼€å‘å»ºè®®

### 1. ç”¨æˆ·è®¤è¯åŠŸèƒ½ï¼ˆå¾…å®ç°ï¼‰
- [ ] å®ç°ç™»å½•åŠŸèƒ½å¯¹æ¥åç«¯
- [ ] Token ç®¡ç†å’Œè‡ªåŠ¨åˆ·æ–°
- [ ] æƒé™æ§åˆ¶

### 2. æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- [ ] ZIP æ–‡ä»¶ä¸Šä¼ åˆ°åç«¯
- [ ] è¿›åº¦æ˜¾ç¤º
- [ ] å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ 

### 3. WebSocket å®æ—¶æ›´æ–°
- [ ] ä»»åŠ¡è¿›åº¦å®æ—¶æ¨é€
- [ ] é—®é¢˜å‘ç°å®æ—¶é€šçŸ¥

### 4. æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½
- [ ] å¯¹æ¥åç«¯æŠ¥å‘Šç”ŸæˆAPI
- [ ] æ”¯æŒå¤šç§æ ¼å¼å¯¼å‡º

## ğŸŒŸ åŠŸèƒ½ç‰¹æ€§

- âœ… è‡ªåŠ¨åˆ‡æ¢æœ¬åœ°/åç«¯æ¨¡å¼
- âœ… ç»Ÿä¸€çš„APIæ¥å£
- âœ… æ•°æ®æ ¼å¼è‡ªåŠ¨è½¬æ¢
- âœ… é”™è¯¯å¤„ç†å’Œå®¹é”™
- âœ… å®Œæ•´çš„ç±»å‹æ”¯æŒ
- âœ… å¼€å‘ä½“éªŒå‹å¥½

## ğŸ“ æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿ
1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’æŸ¥éƒ¨åˆ†
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
3. æŸ¥çœ‹åç«¯æ—¥å¿—
4. è®¿é—®åç«¯APIæ–‡æ¡£: http://localhost:8000/api/v1/docs

---

**é…ç½®å®Œæˆæ—¥æœŸ**: 2025-11-02  
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶å¯ç”¨

**ç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨å®Œæ•´çš„å‰åç«¯åŠŸèƒ½äº†ï¼** ğŸ‰

