# DeepAudit Agent å®¡è®¡æ¨¡å— v3.0.0

## æ¦‚è¿°

Agent å®¡è®¡æ¨¡å—æ˜¯ DeepAudit v3.0.0 çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŸºäº **Multi-Agent æ¶æ„** å®ç°è‡ªä¸»ä»£ç å®‰å…¨åˆ†æå’Œæ¼æ´éªŒè¯ã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸ¤– **Multi-Agent åä½œ**: Orchestrator ç¼–æ’å†³ç­–ï¼Œå¤šæ™ºèƒ½ä½“åä½œå®¡è®¡
- ğŸ§  **RAG çŸ¥è¯†åº“å¢å¼º**: ä»£ç è¯­ä¹‰ç†è§£ + CWE/CVE æ¼æ´çŸ¥è¯†åº“
- ğŸ”’ **æ²™ç®±æ¼æ´éªŒè¯**: Docker å®‰å…¨å®¹å™¨è‡ªåŠ¨æ‰§è¡Œ PoC
- ğŸ› ï¸ **ä¸“ä¸šå·¥å…·é›†æˆ**: Semgrepã€Banditã€Gitleaksã€OSV-Scanner ç­‰

---

## æ¶æ„è®¾è®¡

### Multi-Agent å·¥ä½œæµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DeepAudit Agent å®¡è®¡å·¥ä½œæµ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚    START                                                            â”‚
â”‚      â”‚                                                              â”‚
â”‚      â–¼                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               Orchestrator Agent (ç¼–æ’å†³ç­–)                      â”‚ â”‚
â”‚  â”‚  â€¢ åˆ†æå®¡è®¡ç›®æ ‡          â€¢ åˆ¶å®šå®¡è®¡ç­–ç•¥                          â”‚ â”‚
â”‚  â”‚  â€¢ åˆ†é…å­ä»»åŠ¡            â€¢ æ±‡æ€»å®¡è®¡ç»“æœ                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                               â”‚                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚              â–¼                â–¼                â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Recon Agent    â”‚ â”‚  Analysis Agent  â”‚ â”‚Verification Agentâ”‚    â”‚
â”‚  â”‚  (ä¿¡æ¯æ”¶é›†)      â”‚ â”‚  (æ¼æ´åˆ†æ)      â”‚ â”‚  (æ¼æ´éªŒè¯)      â”‚    â”‚
â”‚  â”‚                  â”‚ â”‚                  â”‚ â”‚                  â”‚    â”‚
â”‚  â”‚ â€¢ é¡¹ç›®ç»“æ„åˆ†æ   â”‚ â”‚ â€¢ Semgrep æ‰«æ   â”‚ â”‚ â€¢ æ²™ç®±æµ‹è¯•      â”‚    â”‚
â”‚  â”‚ â€¢ æŠ€æœ¯æ ˆè¯†åˆ«     â”‚ â”‚ â€¢ RAG è¯­ä¹‰æœç´¢   â”‚ â”‚ â€¢ PoC ç”Ÿæˆ      â”‚    â”‚
â”‚  â”‚ â€¢ å…¥å£ç‚¹å‘ç°     â”‚ â”‚ â€¢ LLM æ·±åº¦åˆ†æ   â”‚ â”‚ â€¢ è¯¯æŠ¥è¿‡æ»¤      â”‚    â”‚
â”‚  â”‚ â€¢ ä¾èµ–æ‰«æ       â”‚ â”‚ â€¢ æ•°æ®æµè¿½è¸ª     â”‚ â”‚ â€¢ ç½®ä¿¡åº¦è¯„ä¼°    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                    â”‚                    â”‚               â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     Report Generation                           â”‚ â”‚
â”‚  â”‚  â€¢ æ¼æ´æ±‡æ€»              â€¢ å®‰å…¨è¯„åˆ†                            â”‚ â”‚
â”‚  â”‚  â€¢ ä¿®å¤å»ºè®®              â€¢ ç»Ÿè®¡åˆ†æ                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚                              END                                    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Agent èŒè´£

| Agent | èŒè´£ | ä½¿ç”¨å·¥å…· |
|-------|------|----------|
| **Orchestrator** | ç»Ÿç­¹ç¼–æ’ï¼Œè‡ªä¸»å†³ç­–å®¡è®¡ç­–ç•¥ | ä»»åŠ¡åˆ†é…ã€ç»“æœæ±‡æ€» |
| **Recon** | ä¿¡æ¯æ”¶é›†ï¼Œè¯†åˆ«æŠ€æœ¯æ ˆå’Œå…¥å£ç‚¹ | list_files, npm_audit, safety_scan, gitleaks |
| **Analysis** | æ·±åº¦åˆ†æï¼ŒæŒ–æ˜æ½œåœ¨å®‰å…¨æ¼æ´ | semgrep, bandit, rag_query, code_analysis |
| **Verification** | æ²™ç®±éªŒè¯ï¼Œç¡®è®¤æ¼æ´çœŸå®æœ‰æ•ˆ | sandbox_exec, vulnerability_validation |

---

## å¿«é€Ÿå¼€å§‹

### 1. éƒ¨ç½² Agent æ¨¡å¼

```bash
# é…ç½®ç¯å¢ƒå˜é‡
cp backend/env.example backend/.env
# ç¼–è¾‘ .envï¼Œè®¾ç½® AGENT_ENABLED=true

# å¯åŠ¨å®Œæ•´æœåŠ¡
docker compose up -d
```

### 2. æ„å»ºæ²™ç®±é•œåƒ

```bash
cd docker/sandbox
./build.sh
```

### 3. ä½¿ç”¨ Agent å®¡è®¡

1. åœ¨é¡¹ç›®è¯¦æƒ…é¡µç‚¹å‡» "Agent å®¡è®¡"
2. é€‰æ‹©ç›®æ ‡æ¼æ´ç±»å‹
3. å¯é€‰ï¼šä¸Šä¼ çŸ¥è¯†åº“æ–‡ä»¶å¢å¼ºæ£€æµ‹
4. å¯åŠ¨å®¡è®¡ï¼Œå®æ—¶æŸ¥çœ‹ Agent æ‰§è¡Œæ—¥å¿—

---

## å·¥å…·é›†

### å†…ç½®å·¥å…·

| å·¥å…· | åŠŸèƒ½ | Agent |
|------|------|-------|
| `list_files` | ç›®å½•æµè§ˆ | Recon |
| `read_file` | æ–‡ä»¶è¯»å– | All |
| `search_code` | ä»£ç æœç´¢ | Analysis |
| `rag_query` | è¯­ä¹‰æ£€ç´¢ | Analysis |
| `security_search` | å®‰å…¨ä»£ç æœç´¢ | Analysis |
| `function_context` | å‡½æ•°ä¸Šä¸‹æ–‡ | Analysis |
| `pattern_match` | æ¨¡å¼åŒ¹é… | Analysis |
| `code_analysis` | LLM åˆ†æ | Analysis |
| `dataflow_analysis` | æ•°æ®æµè¿½è¸ª | Analysis |
| `vulnerability_validation` | æ¼æ´éªŒè¯ | Verification |
| `sandbox_exec` | æ²™ç®±æ‰§è¡Œ | Verification |
| `verify_vulnerability` | è‡ªåŠ¨éªŒè¯ | Verification |

### å¤–éƒ¨å®‰å…¨å·¥å…·

| å·¥å…· | åŠŸèƒ½ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `semgrep_scan` | Semgrep é™æ€åˆ†æ | å¤šè¯­è¨€å¿«é€Ÿæ‰«æ |
| `bandit_scan` | Bandit Python æ‰«æ | Python å®‰å…¨åˆ†æ |
| `gitleaks_scan` | Gitleaks å¯†é’¥æ£€æµ‹ | å¯†é’¥æ³„éœ²æ£€æµ‹ |
| `trufflehog_scan` | TruffleHog æ‰«æ | æ·±åº¦å¯†é’¥æ‰«æ |
| `npm_audit` | npm ä¾èµ–å®¡è®¡ | Node.js ä¾èµ–æ¼æ´ |
| `safety_scan` | Safety Python å®¡è®¡ | Python ä¾èµ–æ¼æ´ |
| `osv_scan` | OSV æ¼æ´æ‰«æ | å¤šè¯­è¨€ä¾èµ–æ¼æ´ |

---

## RAG ç³»ç»Ÿ

### åŠŸèƒ½ç‰¹ç‚¹

- **ä»£ç åˆ†å—**: åŸºäº Tree-sitter AST çš„æ™ºèƒ½åˆ†å—
- **å‘é‡å­˜å‚¨**: ChromaDB æŒä¹…åŒ–
- **å¤šè¯­è¨€æ”¯æŒ**: Python, JavaScript, TypeScript, Java, Go, PHP, Rust ç­‰
- **çŸ¥è¯†åº“å¢å¼º**: æ”¯æŒä¸Šä¼ è‡ªå®šä¹‰æ¼æ´çŸ¥è¯†åº“

### é…ç½®

```env
# åµŒå…¥æ¨¡å‹é…ç½®
EMBEDDING_PROVIDER=openai
EMBEDDING_MODEL=text-embedding-3-small

# å‘é‡æ•°æ®åº“é…ç½®
VECTOR_DB_TYPE=chroma
```

---

## å®‰å…¨æ²™ç®±

### åŠŸèƒ½ç‰¹ç‚¹

- **Docker éš”ç¦»**: å®‰å…¨å®¹å™¨æ‰§è¡Œ PoC
- **èµ„æºé™åˆ¶**: å†…å­˜ã€CPU é™åˆ¶
- **ç½‘ç»œéš”ç¦»**: å¯é…ç½®ç½‘ç»œè®¿é—®
- **seccomp ç­–ç•¥**: ç³»ç»Ÿè°ƒç”¨ç™½åå•

### é…ç½®

```env
SANDBOX_ENABLED=true
SANDBOX_IMAGE=deepaudit-sandbox:latest
SANDBOX_MEMORY_LIMIT=512m
SANDBOX_CPU_LIMIT=1.0
SANDBOX_NETWORK_DISABLED=true
```

### æ²™ç®±é•œåƒå†…ç½®å·¥å…·

- Python 3.11 + Semgrep, Bandit, Safety
- Node.js 20 + npm audit
- Go 1.21 + OSV-Scanner
- Rust + cargo-audit
- Gitleaks, TruffleHog

---

## API æ¥å£

### åˆ›å»ºä»»åŠ¡

```http
POST /api/v1/agent-tasks/
Content-Type: application/json

{
  "project_id": "xxx",
  "name": "å®‰å…¨å®¡è®¡",
  "target_vulnerabilities": ["sql_injection", "xss"],
  "verification_level": "sandbox",
  "max_iterations": 3
}
```

### äº‹ä»¶æµ

```http
GET /api/v1/agent-tasks/{task_id}/events
Accept: text/event-stream
```

### è·å–å‘ç°

```http
GET /api/v1/agent-tasks/{task_id}/findings?verified_only=true
```

### ä»»åŠ¡æ‘˜è¦

```http
GET /api/v1/agent-tasks/{task_id}/summary
```

### å¯¼å‡ºæŠ¥å‘Š

```http
GET /api/v1/agent-tasks/{task_id}/report?format=markdown
```

---

## æ”¯æŒçš„æ¼æ´ç±»å‹

| ç±»å‹ | è¯´æ˜ |
|------|------|
| `sql_injection` | SQL æ³¨å…¥ |
| `xss` | è·¨ç«™è„šæœ¬ |
| `command_injection` | å‘½ä»¤æ³¨å…¥ |
| `path_traversal` | è·¯å¾„éå† |
| `ssrf` | æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€  |
| `xxe` | XML å¤–éƒ¨å®ä½“ |
| `insecure_deserialization` | ä¸å®‰å…¨ååºåˆ—åŒ– |
| `hardcoded_secret` | ç¡¬ç¼–ç å¯†é’¥ |
| `weak_crypto` | å¼±åŠ å¯† |
| `authentication_bypass` | è®¤è¯ç»•è¿‡ |
| `authorization_bypass` | æˆæƒç»•è¿‡ |
| `idor` | ä¸å®‰å…¨ç›´æ¥å¯¹è±¡å¼•ç”¨ |

---

## ç›®å½•ç»“æ„

```
backend/app/services/agent/
â”œâ”€â”€ __init__.py              # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ event_manager.py         # äº‹ä»¶ç®¡ç†
â”œâ”€â”€ agents/                  # Agent å®ç°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py             # Agent åŸºç±»
â”‚   â”œâ”€â”€ recon.py            # ä¿¡æ¯æ”¶é›† Agent
â”‚   â”œâ”€â”€ analysis.py         # æ¼æ´åˆ†æ Agent
â”‚   â”œâ”€â”€ verification.py     # æ¼æ´éªŒè¯ Agent
â”‚   â””â”€â”€ orchestrator.py     # ç¼–æ’ Agent
â”œâ”€â”€ tools/                   # Agent å·¥å…·
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py             # å·¥å…·åŸºç±»
â”‚   â”œâ”€â”€ rag_tool.py         # RAG å·¥å…·
â”‚   â”œâ”€â”€ pattern_tool.py     # æ¨¡å¼åŒ¹é…å·¥å…·
â”‚   â”œâ”€â”€ code_analysis_tool.py
â”‚   â”œâ”€â”€ file_tool.py        # æ–‡ä»¶æ“ä½œ
â”‚   â”œâ”€â”€ sandbox_tool.py     # æ²™ç®±å·¥å…·
â”‚   â””â”€â”€ external_tools.py   # å¤–éƒ¨å®‰å…¨å·¥å…·
â””â”€â”€ prompts/                 # ç³»ç»Ÿæç¤ºè¯
    â”œâ”€â”€ __init__.py
    â””â”€â”€ system_prompts.py
```

---

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: Agent å®¡è®¡å¯åŠ¨å¤±è´¥**

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹åç«¯æ—¥å¿—
docker compose logs backend | grep -i agent
```

**Q: RAG åˆå§‹åŒ–å¤±è´¥**

```bash
# æ£€æŸ¥åµŒå…¥æ¨¡å‹é…ç½®
# ç¡®ä¿ EMBEDDING_API_KEY æ­£ç¡®è®¾ç½®
```

**Q: æ²™ç®±æ‰§è¡Œå¤±è´¥**

```bash
# æ£€æŸ¥æ²™ç®±é•œåƒ
docker images | grep deepaudit-sandbox

# é‡æ–°æ„å»ºæ²™ç®±
cd docker/sandbox && ./build.sh
```

**Q: å¤–éƒ¨å·¥å…·ä¸å¯ç”¨**

```bash
# æ£€æŸ¥å·¥å…·å®‰è£…ï¼ˆæœ¬åœ°å¼€å‘æ—¶ï¼‰
which semgrep bandit gitleaks

# æˆ–ä½¿ç”¨ Docker æ²™ç®±æ‰§è¡Œ
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹ Agent æ—¥å¿—
docker compose logs -f backend | grep -E "(agent|Agent)"

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
tail -f logs/agent.log
```

---

## æ›´å¤šèµ„æº

- [éƒ¨ç½²æŒ‡å—](DEPLOYMENT.md) - å®Œæ•´éƒ¨ç½²è¯´æ˜
- [é…ç½®è¯´æ˜](CONFIGURATION.md) - è¯¦ç»†é…ç½®å‚æ•°
- [æ¶æ„è¯¦è§£](AGENT_AUDIT_ARCHITECTURE.md) - æ·±åº¦æ¶æ„æ–‡æ¡£
